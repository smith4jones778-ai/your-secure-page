<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Client Service Portal</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --brand:#2563eb;
  --bg:#f1f5f9;
  --text:#0f172a;
  --muted:#64748b;
  --border:#e2e8f0;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,system-ui,Arial;
  color:var(--text);
  background:var(--bg);
}

/* HEADER */
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:20px 40px;
  background:white;
  border-bottom:1px solid var(--border);
}
.logo{font-weight:700;font-size:20px}
.header button{
  background:var(--brand);
  color:white;
  border:none;
  padding:10px 16px;
  border-radius:8px;
  cursor:pointer;
}

/* HERO */
.hero{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:40px;
  padding:60px 40px;
  align-items:center;
}
.hero h1{font-size:42px;margin-bottom:10px}
.hero p{color:var(--muted);font-size:18px}
.hero img{
  width:100%;
  border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,0.1);
  animation:fade 1s ease;
}

@keyframes fade{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:none}
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.4);
  display:none;
  align-items:center;
  justify-content:center;
}
.box{
  background:white;
  width:380px;
  padding:20px;
  border-radius:12px;
  animation:fade .25s ease;
}
input,select,button{
  width:100%;
  padding:10px;
  margin:6px 0;
}
.primary{
  background:var(--brand);
  color:white;
  border:none;
}
.google{
  background:#db4437;
  color:white;
  border:none;
}
.link{
  background:none;
  border:none;
  color:var(--brand);
  cursor:pointer;
}
.msg{
  background:#fee2e2;
  color:#991b1b;
  padding:8px;
  border-radius:6px;
  font-size:14px;
  display:none;
}

/* FOOTER */
.footer{
  text-align:center;
  padding:25px;
  margin-top:40px;
  background:white;
  border-top:1px solid var(--border);
  color:var(--muted);
}

@media(max-width:800px){
  .hero{grid-template-columns:1fr}
}
</style>
</head>

<body>

<header class="header">
  <div class="logo">Service Portal</div>
  <button onclick="openAuth()">Login / Sign Up</button>
</header>

<section class="hero">
  <div>
    <h1>Professional Client Access</h1>
    <p>
      Securely submit inquiries, download resources,
      and receive real-time responses from our team.
    </p>
  </div>

  <!-- Replace with your own image if desired -->
  <img src="https://images.unsplash.com/photo-1551434678-e076c223a692?q=80&w=1200&auto=format&fit=crop">
</section>

<footer class="footer">
  © 2026 Service Portal • Privacy • Terms • Contact
</footer>

<!-- AUTH -->
<div class="modal" id="authModal">
  <div class="box">
    <h3>Welcome</h3>

    <div id="msg" class="msg"></div>

    <button class="google" onclick="google()">Continue with Google</button>

    <hr>

    <input id="email" placeholder="Email">
    <input id="pass" type="password" placeholder="Password">

    <button class="primary" onclick="login()">Login</button>
    <button class="link" onclick="signup()">Create account</button>
  </div>
</div>

<!-- PROFILE -->
<div class="modal" id="profileModal">
  <div class="box">
    <h3>Complete Your Profile</h3>

    <input id="name" placeholder="Full name">
    <input id="phone" placeholder="Phone">
    <input id="location" placeholder="Location">
    <select id="gender">
      <option value="">Gender</option>
      <option>Male</option>
      <option>Female</option>
    </select>

    <button class="primary" onclick="saveProfile()">Save & Continue</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCl6RLrInQotd-GYmJ3VtA4wpAHfFltRUg",
  authDomain: "page-97b26.firebaseapp.com",
  projectId: "page-97b26",
  storageBucket: "page-97b26.firebasestorage.app",
  messagingSenderId: "268450715801",
  appId: "1:268450715801:web:33732e0f2fc2a69cfa0008"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db   = firebase.database();

/* helpers */
const $ = id => document.getElementById(id);

function openAuth(){ $("authModal").style.display="flex"; }

function friendly(error){
  const m={
    "auth/user-not-found":"Account not found.",
    "auth/wrong-password":"Incorrect password.",
    "auth/email-already-in-use":"Email already registered.",
    "auth/weak-password":"Password should be at least 6 characters."
  };
  return m[error.code] || error.message;
}

function showError(t){
  const el=$("msg");
  el.style.display="block";
  el.innerText=t;
}

/* LOGIN */
function login(){
  showError("");
  auth.signInWithEmailAndPassword(
    $("email").value.trim(),
    $("pass").value.trim()
  ).catch(e=>showError(friendly(e)));
}

/* SIGNUP */
function signup(){
  showError("");
  auth.createUserWithEmailAndPassword(
    $("email").value.trim(),
    $("pass").value.trim()
  ).catch(e=>showError(friendly(e)));
}

/* GOOGLE */
function google(){
  const provider=new firebase.auth.GoogleAuthProvider();
  auth.signInWithRedirect(provider);
}

/* avoid duplicate handling */
auth.getRedirectResult().catch(()=>{});

let currentUser=null;

/* AUTH STATE */
auth.onAuthStateChanged(async u=>{
  if(!u) return;

  currentUser=u;
  $("authModal").style.display="none";

  const userRef=db.ref("users/"+u.uid);
  const snap=await userRef.once("value");

  /* existing user */
  if(snap.exists()){
    return route(snap.val().role);
  }

  /* first ever account -> super admin */
  const countSnap = await db.ref("users").limitToFirst(1).once("value");
  if(!countSnap.exists()){
    await userRef.set({
      name:u.displayName||"",
      email:u.email,
      role:"superadmin",
      createdAt:Date.now()
    });
    return route("admin");
  }

  /* otherwise collect profile */
  $("profileModal").style.display="flex";
});

/* SAVE PROFILE */
async function saveProfile(){
  if(!currentUser) return alert("Session not ready.");

  const data={
    name:$("name").value.trim(),
    email:currentUser.email,
    phone:$("phone").value.trim(),
    location:$("location").value.trim(),
    gender:$("gender").value,
    role:"user",
    createdAt:Date.now()
  };

  if(!data.name || !data.location){
    alert("Please complete required fields.");
    return;
  }

  try{
    await db.ref("users/"+currentUser.uid).set(data);
    await db.ref("analytics/usersCount").transaction(n=>(n||0)+1);
    route("user");
  }catch(e){
    alert("Save failed: "+e.message);
  }
}

/* ROUTE */
function route(role){
  if(role==="superadmin" || role==="admin") location="admin.html";
  else location="user.html";
}
</script>


</body>
</html>
