<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>User Portal</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --brand:#2563eb;
  --bg:#f8fafc;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
  --border:#e2e8f0;
  --success:#16a34a;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,system-ui;
  background:linear-gradient(180deg,#eef2ff,#f8fafc);
  color:var(--text);
}

/* HEADER */
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px 28px;
  background:#fff;
  border-bottom:1px solid var(--border);
}
.logout{
  background:var(--brand);
  color:#fff;
  border:none;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
}

/* LAYOUT */
.wrap{max-width:1100px;margin:auto;padding:24px;}
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
}

/* BUTTONS */
button.primary{
  background:var(--brand);
  color:#fff;
  border:none;
  padding:10px 16px;
  border-radius:10px;
  cursor:pointer;
}
button.ghost{
  background:none;
  border:1px solid var(--border);
  padding:8px 14px;
  border-radius:10px;
  cursor:pointer;
}

/* CARD */
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:16px;
  margin-bottom:16px;
}

/* FILTERS */
.filters{
  display:flex;
  gap:10px;
  margin-bottom:12px;
}
.filters input,.filters select{
  padding:8px;
  border-radius:10px;
  border:1px solid var(--border);
}

/* INQUIRY ITEM */
.item{
  border:1px solid var(--border);
  border-radius:12px;
  padding:14px;
  margin-bottom:10px;
}
.badge{
  font-size:12px;
  padding:3px 10px;
  border-radius:20px;
}
.open{background:#fee2e2;color:#991b1b}
.answered{background:#dcfce7;color:#166534}

/* THREAD */
.thread{margin-top:10px}
.msg{
  padding:8px 10px;
  border-radius:10px;
  margin-bottom:6px;
  font-size:14px;
}
.user{background:#eef2ff}
.admin{background:#ecfeff}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:none;
  align-items:center;
  justify-content:center;
}
.modal.show{display:flex}
.modal-content{
  background:#fff;
  width:100%;
  max-width:500px;
  border-radius:14px;
  padding:18px;
}

/* FORM */
textarea,input{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid var(--border);
  font-family:inherit;
  margin-bottom:10px;
}
textarea{height:90px;resize:none}

/* MISC */
.empty{color:var(--muted);text-align:center;padding:20px}
.loadmore{text-align:center;margin-top:10px}
</style>
</head>

<body>

<div class="header">
  <b>Client Area</b>
  <button class="logout" onclick="logout()">Logout</button>
</div>

<div class="wrap">

  <div class="topbar">
    <h2 id="hello">Welcome ðŸ‘‹</h2>
    <button class="primary" onclick="openModal()">+ New Inquiry</button>
  </div>

  <div class="card">
    <h3>My Inquiries</h3>

    <div class="filters">
      <input id="search" placeholder="Search">
      <select id="status">
        <option value="">All</option>
        <option value="open">Open</option>
        <option value="answered">Answered</option>
      </select>
    </div>

    <div id="list"></div>
    <div class="loadmore">
      <button class="ghost" onclick="loadMore()">Load more</button>
    </div>
  </div>

</div>

<!-- MODAL -->
<div id="modal" class="modal">
  <div class="modal-content">
    <h3>New Inquiry</h3>
    <textarea id="msg" placeholder="Describe your issue"></textarea>
    <input type="file" id="files" multiple>
    <button class="primary" onclick="send()">Send</button>
    <button class="ghost" onclick="closeModal()">Cancel</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyCl6RLrInQotd-GYmJ3VtA4wpAHfFltRUg",
  authDomain:"page-97b26.firebaseapp.com",
  projectId:"page-97b26",
  storageBucket:"page-97b26.firebasestorage.app"
});

const auth=firebase.auth();
const db=firebase.database();
const storage=firebase.storage();
const $=id=>document.getElementById(id);

let uid=null, all=[], limit=5;

/* AUTH */
auth.onAuthStateChanged(async u=>{
  if(!u) return location="index.html";
  uid=u.uid;
  const name=(await db.ref("users/"+uid+"/name").once("value")).val();
  $("hello").innerText=`Welcome, ${name||"User"} ðŸ‘‹`;
  load();
});

/* MODAL */
const openModal=()=>$("modal").classList.add("show");
const closeModal=()=>$("modal").classList.remove("show");

/* LOAD */
function load(){
  db.ref("inquiries").on("value",s=>{
    all=[];
    s.forEach(c=>{
      const d=c.val();
      if(d.uid===uid) all.push({...d,id:c.key});
    });
    render();
  });
}

/* RENDER */
function render(){
  const q=$("search").value.toLowerCase();
  const st=$("status").value;
  $("list").innerHTML="";

  const filtered=all
    .filter(i=>{
      const t=i.thread?.[0]?.text||i.message||"";
      return (!q||t.toLowerCase().includes(q)) && (!st||i.status===st);
    })
    .sort((a,b)=>b.createdAt-a.createdAt)
    .slice(0,limit);

  if(!filtered.length)
    return $("list").innerHTML='<div class="empty">No inquiries</div>';

  filtered.forEach(i=>{
    const thread=Array.isArray(i.thread)?i.thread:[
      {from:"user",text:i.message||"",files:[]},
      ...(i.response?[{from:"admin",text:i.response,files:[]}]:[])
    ];

    $("list").innerHTML+=`
      <div class="item">
        <span class="badge ${i.status||"open"}">${i.status||"open"}</span>
        <div class="thread">
          ${thread.map(m=>`
            <div class="msg ${m.from}">${m.text}</div>
          `).join("")}
        </div>
      </div>
    `;
  });
}

$("search").oninput=render;
$("status").onchange=render;
const loadMore=()=>{limit+=5;render();};

/* SEND */
async function send(){
  const text=$("msg").value.trim();
  if(!text) return;

  const ref=db.ref("inquiries").push();
  const uploads=[];
  for(const f of $("files").files){
    const r=storage.ref(`inquiries/${uid}/${Date.now()}_${f.name}`);
    await r.put(f);
    uploads.push({name:f.name,url:await r.getDownloadURL()});
  }

  await ref.set({
    uid,
    status:"open",
    createdAt:Date.now(),
    thread:[{from:"user",text,files:uploads}]
  });

  $("msg").value="";
  $("files").value="";
  closeModal();
}
function logout(){auth.signOut();}
</script>

</body>
</html>
